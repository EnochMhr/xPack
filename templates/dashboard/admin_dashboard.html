{% extends 'dashboard/base.html' %}
{% block title%}Dashboard{% endblock%}

{% block content%}
    <div class="container-fluid">
                    <div class="mb-3">
                        <h3 class="fw-bold fs-4 mb-3">Admin Dashboard</h3>
                        <ol class="breadcrumb mb-4">
                            <li class="breadcrumb-item">Dashboard</li>
                        </ol>
                    </div>

                    <div class="row ">
                        <!-- card 1 -->
                        <div class="col-12 col-md-3">
                            <div class="card shadow border-0 card-1">
                                <div class="card-body card-a py-4">
                                    <h6 class="mb-2 fw-bold">
                                        Members
                                    </h6>
                                    <div class="fw-bold mb-2 d-flex justify-content-between align-items-center">
                                        <div>{{ members_count }}</div>
                                        <div class="card-con con-1">
                                            <i class='bxr  bx-user'  ></i> 
                                        </div>
                                    </div>
                                    <div class="mb-0">
                                        <span class="badge text-success me-2">
                                            +{{ growth_percentage }}%
                                        </span>
                                        <span class="fw-bold rec">
                                            {{ year }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- card 2 -->
                        <div class="col-12 col-md-3">
                            <div class="card shadow border-0 card-2">
                                <div class="card-body card-b py-4">
                                    <h6 class="mb-2 fw-bold">
                                       Visitors
                                    </h6>
                                    <div class="fw-bold mb-2 d-flex justify-content-between align-items-center">
                                        <div>{{ visitors_count }}</div>
                                        <div class="card-con con-2">
                                            <i class='bxr  bx-user'  ></i> 
                                        </div>
                                    </div>
                                    <div class="mb-0">
                                        <span class="badge text-secondary me-2">
                                            Total
                                        </span>
                                        <span class="fw-bold rec">
                                            {{ year }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- card 3 -->
                        <div class="col-12 col-md-3">
                            <div class="card shadow border-0 card-3">
                                <div class="card-body card-c py-4">
                                    <h6 class="mb-2 fw-bold">
                                        Served Packs
                                    </h6>
                                    <div class="fw-bold mb-2 d-flex justify-content-between align-items-center">
                                        <div>{{ served_count }}</div>
                                        <div class="card-con con-3">
                                            <i class='bxr  bx-gift'  ></i> 
                                        </div>
                                    </div>
                                    <div class="mb-0">
                                        <span class="fw-bold rec text-success">
                                            recorded today
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- card 4 -->
                        <div class="col-12 col-md-3">
                            <div class="card shadow border-0 card-0">
                                <div class="card-body card-d py-4">
                                    <h6 class="mb-2 fw-bold">
                                        Rejected packs
                                    </h6>
                                    <div class="fw-bold mb-2 d-flex justify-content-between align-items-center">
                                        <div>{{ rejected_count }}</div>
                                        <div class="card-con con-4">
                                            <i class='bxr  bx-no-entry'  ></i> 
                                        </div>
                                    </div>
                                    <div class="mb-0">
                                        <!-- <span class="badge text-success me-2">
                                            +9.0%
                                        </span> -->
                                        <span class="fw-bold rec text-success">
                                            recorded today
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                            
                            <div class="col-12 col-md-6 my-3">
                                <h3 class="fw-bold fs-4 my-5">Registry Summary</h3>
                            <div class="card mb-4 border-0 shadow">
                            <!-- <div class="card-header">
                                <i class='bxr  bx-table'  ></i> 
                                    Registry 
                                </div> -->
                            <div class="card-body table-responsive">
                                <table id="registryTable" class="table table-striped tab-siz">
                                    <thead>
                                        <tr class="highlight">
                                            <th>RID</th>
                                            <th>Name</th>
                                            <th>Contact</th>
                                            <th>Family</th>
                                            <th>Membership</th>
                                        </tr>
                                    </thead>
                                
                                    <tbody>
                                        {% for entry in entry_list %}
                                        <tr>
                                            <td>{{ entry.id }}</td>
                                            <td>{{ entry.name }}</td>
                                            <td>{{ entry.contact }}</td>
                                            <td>{{ entry.family }}</td>
                                            <td>
                                                {% if entry.membership == 'Member' %}
                                                <p class="badge text-bg-success text-center">Member</p>
                                                {% elif entry.membership == 'Visitor' %}
                                                <p class="badge text-bg-warning text-center">Visitor</p>
                                                {% else %}
                                                <p class="badge text-bg-secondary text-center">{{ entry.membership }}</p>
                                                {% endif %}
                                            </td>
                                        </tr>
                                        {% empty %}
                                        <tr>
                                            <td colspan="5" class="text-center">No entries found</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                    <!-- <tfoot>
                                        <tr class="highlight">
                                            <th>RID</th>
                                            <th>Name</th>
                                            <th>Contact</th>
                                            <th>Family</th>
                                            <th>Membership</th>
                                        </tr>
                                    </tfoot> -->
                                </table>
                            </div>
                        </div>
                    </div>

                            <div class="col-12 col-md-6 my-3">
                                <h3 class="h3 fw-bold fs-4 my-5">
                                    Reports Overview
                                </h3>
                                <div class="card mb-4 border-0 shadow p-2">
                                    <!-- <div class="card-header">
                                        <i class='bxr  bx-bar-chart'  ></i> 
                                        Area Chart
                                    </div> -->
                                <div class="card-body"></div><canvas id="bar-chart-grouped" width="800" height="300"></canvas></div>
                            </div>
                    </div>

                </div>
            
{% endblock %}

{% block extra_scripts %}
<script>
    $(document).ready(function() {
        // Simple DataTable initialization
        $('#registryTable').DataTable({
            pageLength: 5,
            lengthMenu: [[5, 10, 25, 50], [5, 10, 25, 50]],
            order: [[0, 'desc']], // Sort by ID descending by default
            searching: true,
            info: true,
            paging: true
        });

        // Initialize the time-series chart with data from Django context
        // Parse the Django template variable containing chart data
        var chartData;
        try {
            chartData = JSON.parse('{{ chart_data|escapejs }}');
        } catch (e) {
            console.error('Error parsing chart data:', e);
            chartData = { intervals: [], members: [], visitors: [] };
        }

        // Create the chart with the parsed data
        new Chart(document.getElementById("bar-chart-grouped"), {
            type: 'bar',
            data: {
                labels: chartData.intervals,
                datasets: [
                    {
                        label: "Members",
                        backgroundColor: "#198754",
                        data: chartData.members
                    },
                    {
                        label: "Visitors",
                        backgroundColor: "#ffc107",
                        data: chartData.visitors
                    }
                ]
            },
            options: {
                responsive: true,
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'Time (30-minute intervals)'
                        }
                    },
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Number of Registrations'
                        }
                    }
                },
                plugins: {
                    title: {
                        display: true,
                        text: 'Registrations per 30-minute interval'
                    },
                    legend: {
                        position: 'top'
                    }
                }
            }
        });
    });
</script>
{% endblock extra_scripts %}
